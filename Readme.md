# Рабочая «сетевая» версия проекта «Чат» (C++17/Qt/Win)

## Что сделано

### Серверная часть с GUI (Qt Widgets)

- Окно администратора с вкладками:
  - **Users** — список всех пользователей (обновляется каждые 2 сек). Забаненные помечаются `\[BANNED]` **красным**.
  - **Messages** — полный журнал сообщений (публичные и приватные).
- Тулбар действий:
  - **Start/Stop Server** — запуск/остановка серверного процесса.
  - **Start/Stop Client** — запуск/остановка клиентского процесса (для демонстрации).
  - **Ban…** — диалог с длительностью (минуты, `0 = навсегда`) и причиной; записывает в таблицу `bans`.
  - **Unban** — снятие бана.
- Логика бана/разбана:
  - Проверка бана при авторизации и во время активной сессии.
  - Если бан активен — клиент получает уведомление и немедленно отключается.
  - реализовано через немедленный `disconnect` при бане.
  - Временный бан снимается автоматически при первом же обращении после истечения срока.

### Сервер (сетевой функционал)

- TCP-сервер на `select()`, построчный протокол (`\n`), надёжная отправка (`sendAll`) и корректное закрытие сокетов.
- История при входе: пользователю отдаются публичные и его личные сообщения.
- Команды: `/help`, `/users`, `/w <login> <text>` (личные сообщения).
- Лимит длины сообщения считывается из `config.txt` (`max_message_length`).

### Клиент (консоль)

- Корректная работа с UTF-8 на Windows (избавились от «кракозябр»).
- Вывод истории, системных сообщений, форматированный список пользователей, подсказки команд.

### Хранилище и безопасность

- **SQLite** (`chat.db`) с таблицами: `users`, `messages`, `bans`.
- Пароли в `users.password` хранятся в виде **SHA-1 (5×uint)**.
- Есть миграция: если для старой записи найден «простой» пароль — на первом успешном входе он преобразуется в хеш.
- `bans(login TEXT PRIMARY KEY, until INTEGER NULL, reason TEXT)`; `NULL` в `until` означает **пермабан**.

### Конфигурация

- `config.txt`: `ip`, `port`, `dictionary`, `max_message_length` и пр.
- При отсутствии файл создаётся с дефолтами.

## Как демонстрировать

1. Запустить приложение **без аргументов** — откроется окно администратора.
2. В тулбаре нажать **Start Server**, при желании — **Start Client** (или запустить отдельного клиента).
3. Во вкладке **Users** выбрать пользователя → **Ban…** (указать минуты/`0` и причину). Клиент **немедленно** отключится, пользователь пометится `\[BANNED]`.
4. **Unban** — снять бан; повторный вход снова доступен.
5. Во вкладке **Messages** видна полная история (публичные и приватные).

## Про базу данных

Задача проекта — показать работу **Qt**, **C++**, **сети**, **GUI** и серверной логики. Всё это реализовано и демонстрируется на **SQLite**. Не требует отдельного сервера, работает как библиотека, интегрированная прямо в приложение. Идеальна для небольших проектов, локального хранения данных.
