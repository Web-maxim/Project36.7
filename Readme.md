# Сетевой чат (C++17 / Qt / Windows)

Графический админ-клиент (Qt Widgets) + TCP-сервер чата. Проект учебный, демонстрирует работу с сетью, SQLite и простым GUI.

## Что внутри

- **GUI-админка (Qt Widgets)**: вкладки *Users* и *Messages*, бан/анбан/кик, запуск/остановка сервер/клиент.
- **Сервер (WinSock + select)**:
  - построчный протокол (`\n`);
  - надёжная отправка через `sendAll(...)` (обработка частичной отправки);
  - история при входе (публичные + мои приватные);
  - команды: `/help`, `/users`, `/w <login> <text>`.
- **Клиент (консоль, UTF-8)**: история, системные сообщения, список пользователей.
- **SQLite (вшитая `sqlite3.c`)**:
  - таблицы `users`, `messages(created_at)`, `bans`, `kicks`;
  - пароли хранятся как SHA-1 (формат 5×uint), есть миграция со старого открытого вида.
  - SHA-1 используется только в учебных целях. 

## Платформа и сборка

- **Windows 10/11, MSVC 2022**, Qt **6.9.x (Widgets)**
- **CMake + Ninja (см. `CMakePresets.json`), C++17**
- **Где расположен бинарник:** `out/build/msvc-qt-release/chat_admin_gui.exe`  
(для Debug-предсета: `out/build/msvc-qt-debug/chat_admin_gui.exe`).

```bash
# пример
cmake --preset msvc-qt-release
cmake --build out/build/msvc-qt-release
```
## Запуск

- Без аргументов — запускается **GUI-админка**.
- Режимы:
  - `--server` — только сервер (консоль).
  - `--client` — консольный клиент.

Примеры:
```bash
# из папки со сборкой
./chat_admin_gui.exe --server
./chat_admin_gui.exe --client
# или просто без аргументов для GUI
./chat_admin_gui.exe
```

## Конфигурация

Файл `config.txt` (создаётся автоматически при первом запуске):
```ini
ip=127.0.0.1
port=5000
max_message_length=200

Где лежат файлы: `config.txt` и база `chat.db` 
создаются рядом с исполняемым файлом (`chat_admin_gui.exe`).

```

## Как демонстрировать

1. Запустить приложение **без аргументов** → откроется админ-окно.
2. Нажать **Start Server**, при желании — **Start Client**.
3. Во вкладке **Users** выбрать пользователя → **Ban…** (минуты или `0`) → клиент будет немедленно отключён, в списке появится `[BANNED]`.
4. **Unban** — снять бан; повторный вход снова доступен.
5. Вкладка **Messages** — полный журнал (публичные + приватные).

## Ограничения и заметки по платформе

- Проект рассчитан на **Windows** (WinSock).
- В сервере используется `select()` с полями `fd_count`/`fd_array` — это специфика WinSock.
- На POSIX (Linux/macOS) `fd_set` — битовая маска, а `select()` требует `maxfd+1`. Поэтому текущий цикл ввода-вывода **не совместим** с Linux без правок.

### Портирование на POSIX (если потребуется)

- Хранить набор активных сокетов самостоятельно (например, `std::vector<int>`/`std::set<int>`).
- Вычислять `maxfd` и вызывать `select(maxfd+1, ...)`.
- Заменить WinSock-специфику (`WSAStartup`, `closesocket`, коды ошибок) на POSIX-аналог (`close`, `errno`). Часть уже абстрагирована в условных инклюдах.

## Учтены замечания проверок прошлых работ

- Все вызовы `send(...)` заменены на `sendAll(...)` (безопаснее при частичных отправках).
- Увеличен буфер приёма на сервере до `4096` байт.
- Вынесена реализация `loadConfig(...)` в `Config.cpp` (исправлена LNK2005).
- Обновлён `CMakeLists.txt` (добавлен `Config.cpp`, явная линковка `ws2_32`).
- README дополнен разделом о платформенной специфике.